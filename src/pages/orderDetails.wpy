<style>
  page{
    height: 100%;
  }
  .mainInAll{
    background: url('data:image/gif;base64,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') no-repeat center center #fff;
    background-attachment: fixed;
    background-size: 40rpx;
    height: 100%;
  }
  .main{
    background:#f9fafb;
    opacity: 0;
  }
  .mainIn {
    -webkit-animation: mainIn .5s .1s ease both
  }
  @keyframes mainIn {
    0% {
      opacity: 0
    }
    100% {
      opacity: 1
    }
  }
  @-webkit-keyframes mainIn {
    0% {
      opacity: 0
    }
    100% {
      opacity: 1
    }
  }
  .redcolor{
    color:#e02e24;
  }
  .blackcolor{
    color:#151516;
  }
  .graycolor{
    color:#58595b;
  }
  .astrict{
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .astrict_tow{
    overflow:hidden;
    text-overflow:ellipsis;
    display:-webkit-box;
    -webkit-box-orient:vertical;
    -webkit-line-clamp:2;
  }
  .order_head{
    height:200rpx;
    width: 100%;
    display: flex;
    color:#ffffff;
    background:#e02e24;
    align-items: center;
  }
  .order_head_left{
    font-size: 38rpx;
    margin-left: 43rpx;
    flex: 1;
  }
  .order-img-box{
    height:170rpx;
    width:170rpx;
    padding-right: 43rpx;
  }
  .order-img-box image{
    width:100%;
    height:100%;
  }
  .order-location{
    height:120rpx;
    width:100%;
    display:flex;
    justify-content: space-between;
    border-bottom:16px solid #f2f2f2;
  }
  .order-location .icon-map{
    color:#ff3f56;
    font-weight:900;
    font-size:38rpx;
    padding:44rpx 20rpx 0 20rpx;
  }
  .order-location-btm{
    color:#606163;
    font-size:30rpx;
    padding:15rpx 0;
    flex:9;
  }
  .order-store{
    display:flex;
    height:76rpx;
    justify-content: flex-start;
    padding-right:23rpx;
  }
  .order-store-box image{
    width:40rpx;
    height:40rpx;
    background:#ebebf0;
  }
  .order-store-right{
    width:100%;
    line-height:76rpx;
    font-weight:600;
    display:flex;
    justify-content:space-between;
  }
  .order-detail{
    width:100%;
    display:flex;
    justify-content: flex-start;
    background:#f5f5f5;
  }
  .order-detail-box{
    padding:20rpx;
    width:200rpx;
    height:180rpx;
    margin-right:10rpx;
  }
  .order-detail-box1{
    width: 100%;
    height:100%;
    background: #fff;
  }
  .order-detail-box image{
    width:100%;
    height:100%;
  }
  .order-detail-center{
    width:398rpx;
    padding-right:20rpx;
    padding-top:20rpx;
    height:180rpx;
  }
  .order-detail-right{
    padding-top:20rpx;
    height:180rpx;
    text-align:right;
    padding-right: 20rpx;
  }
  .order-detail-right .d-price{
    font-size:32rpx;
  }
  .order-detail-right .price{
    font-size:24rpx;
    text-decoration:line-through;
    line-height:60rpx;
  }
  .order-detail-right .number{
    font-size:24rpx;
    line-height:60rpx;
  }
  .order-detail-titl{
    color:#151516;
    font-size:30rpx;
    line-height:40rpx;
  }
  .order-freight{
    font-size: 28rpx;
    padding:0 18rpx 0 18rpx;
  }
  .order-freight-box{
    padding:38rpx 0;
    display:flex;
    justify-content: flex-end;
  }
  .order-end{
    border-top:2rpx solid #f1f1f1;
    display:flex;
    justify-content:space-between;
    text-align:center;
    line-height:80rpx;
    font-size:30rpx;
    padding:20rpx 0;
    font-weight:900;
    border-bottom:15rpx solid #f2f2f2;
  }
  .order-ends{
    padding:20rpx;
    background: #fff;
  }
  .order-endss{
    display:flex;
    align-items: center;
    color:#5c5c5c;
    font-size:30rpx;
    margin-top: 10rpx;
  }
  .icon-map{
    display: block;
  }
  .icon-lx:before{
    color: #359a2b;
    font-size: 40rpx;
    content: "\e60c";
  }
  .icon-dh:before{
    color: #359a2b;
    font-size: 40rpx;
    content: "\e61a";
  }
  .dflexall{
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .fz{
    border:1px solid #5c5c5c;
    border-radius:10rpx;
    padding:6rpx 14rpx;
    margin-left: 10rpx;
  }
</style>

<template>
  <view class="mainInAll">
    <view class="{{LoadingState ? 'main mainIn' : 'main'}}">
      <view class="order_head" wx:if="{{status == 9}}">
        <view class="order_head_left" >
          <span>交易成功</span>
        </view>
        <view class="order-img-box">
          <image src="../assets/img/wc.png" mode="aspectFit"></image>
        </view>
      </view>
      <view class="order_head" wx:if="{{status == 1}}">
        <view class="order_head_left" >
          <span>订单待付款</span>
        </view>
        <view class="order-img-box">
          <image src="../assets/img/funnel.png" mode="aspectFit"></image>
        </view>
      </view>
      <view class="order_head" wx:if="{{status == 2}}">
        <view class="order_head_left" >
          <span>您已取消订单</span>
        </view>
        <view class="order-img-box">
          <image src="../assets/img/sb.png" mode="aspectFit"></image>
        </view>
      </view>
      <view class="order_head" wx:if="{{status == 3}}">
        <view class="order_head_left" >
          <span>商家已取消订单</span>
        </view>
        <view class="order-img-box">
          <image src="../assets/img/sb.png" mode="aspectFit"></image>
        </view>
      </view>
      <view class="order_head" wx:if="{{status == 6}}">
        <view class="order_head_left" >
          <span>订单待发货</span>
        </view>
        <view class="order-img-box">
          <image src="../assets/img/funnel.png" mode="aspectFit"></image>
        </view>
      </view>
      <view class="order_head" wx:if="{{status == 7}}">
        <view class="order_head_left" >
          <span>订单已发货</span>
        </view>
        <view class="order-img-box">
          <image src="../assets/img/funnel.png" mode="aspectFit"></image>
        </view>
      </view>
      <view class="order_head" wx:if="{{status == 5}}">
        <view class="order_head_left" >
          <span>订单已过期</span>
        </view>
        <view class="order-img-box">
          <image src="../assets/img/sb.png" mode="aspectFit"></image>
        </view>
      </view>
      <view class="order-location">
        <view class="iconfont icon-map"></view>
        <view class="order-location-btm">
          <view><span style="padding:0 32rpx 0 0;">{{buyerName}}</span>{{phone}}</view>
          <view style="padding:10rpx 0 0 0" class="astrict"> {{province}} {{city}} {{address}}</view>
        </view>
      </view>
      <view class="order-store">
        <view class="order-store-right">
          <view class="blackcolor astrict" style="margin-left:20rpx; font-size: 28rpx">{{categoryValue}}活动</view>
        </view>
      </view>
      <view class="order-detail">
        <view class="order-detail-box">
          <view class="order-detail-box1">
            <image src="{{img}}" mode="aspectFit"></image>
          </view>
        </view>
        <view class="order-detail-center">
          <view class="astrict_tow order-detail-titl">{{name}}</view>
        </view>
        <view class="order-detail-right">
          <view class="d-price redcolor"><span>￥</span>{{floorPrice}}</view>
          <view class="graycolor  price"><span>￥</span>{{salePrice}}</view>
          <view class="number"><span>×</span>{{quantity}}</view>
        </view>
      </view>
      <view class="order-freight">
        <view class="graycolor order-freight-box">
          实付: <span class="redcolor" style="font-size: 30rpx; margin-right: 10rpx">￥{{floorPrice}}</span><span>(免运费)</span>
        </view>
      </view>
      <view class="order-end">
        <view style="flex:1;" class="dflexall" @tap="tel">
          <span class="ts-iconfont icon-map icon-dh dflex" style="margin-right:15rpx;" @tap="tel"></span><view class="dflex">联系卖家</view>
        </view>
      </view>
      <view class="order-ends">
        <view class="order-endss">
          订单编号： {{orderId}}  <span class="fz" @tap="copyOrderId">复制</span>
        </view>
        <view class="order-endss">
          下单时间： {{orderTime}}
        </view>
        <view class="order-endss" wx:if="{{status == 7}}">
          发货时间： {{shipmentTime}}
        </view>
        <view class="order-endss" wx:if="{{status == 9}}">
          成交时间： {{finishedTime}}
        </view>
        <view class="order-endss" wx:if="{{status == 7}}">
          快递公司： {{logistics}}
        </view>
        <view class="order-endss" wx:if="{{status == 7}}">
          运单编号： {{waybillNumber}}  <span class="fz" @tap="copyWaybillNumber">复制</span>
        </view>
      </view>
    </view>
  </view>
</template>

<script>
  import wepy from 'wepy';
  import {formatDate} from '../common/date';

  export default class Index extends wepy.page {
    config = {
      navigationBarTitleText: '订单详情'
    };
    data = {
      LoadingState: 0,
      categoryId: '',
      orderId: '',
      name: '',
      amount: '',
      province: '',
      city: '',
      address: '',
      buyerName: '',
      phone: '',
      status: '',
      categoryValue: '',
      img: '',
      floorPrice: '',
      salePrice: '',
      quantity: '',
      orderTime: '',
      shipmentTime: '',
      finishedTim: '',
      logistics: '',
      waybillNumber: '',
      contact: ''
    };
    methods = {
      tel() {
        wepy.makePhoneCall({
          phoneNumber: this.contact
        });
      },
      copyOrderId() {
        let me = this;
        if (!me.orderId) {
          wepy.showToast({title: '没有内容', image: '../assets/img/toast-icon.png', mask: 1, duration: 1000});
          return;
        }
        wepy.setClipboardData({
          data: me.orderId,
          success: function(res) {
            wepy.showToast({title: '复制成功', mask: 1, duration: 1000});
          }
        });
      },
      copyWaybillNumber() {
        let me = this;
        if (!me.waybillNumber) {
          wepy.showToast({title: '没有内容', image: '../assets/img/toast-icon.png', mask: 1, duration: 1000});
          return;
        }
        wepy.setClipboardData({
          data: me.waybillNumber,
          success: function(res) {
            wepy.showToast({title: '复制成功', mask: 1, duration: 1000});
          }
        });
      }
    };
    onLoad(options) {
      let me = this;
      me.orderId = options.orderId;
      me.categoryId = options.categoryId;
      wepy.request({
        url: `${me.$parent.APIServer}/guide/order/${me.orderId}`,
        method: 'GET',
        header: {
          'accessToken': me.$parent.globalData.accessToken
        },
        success: function (data) {
          let result = data.data.data;
          if (result) {
            me.LoadingState = 1;
            me.name = result.activity.name;
            me.categoryValue = result.activity.categoryValue;
            me.status = result.status;
            me.amount = result.subOrders[0].price;
            me.province = JSON.parse(result.address).province;
            me.city = JSON.parse(result.address).city;
            me.address = JSON.parse(result.address).address;
            me.buyerName = JSON.parse(result.address).name;
            me.phone = JSON.parse(result.address).phone;
            me.img = JSON.parse(result.activity.properties).filePaths[0];
            me.floorPrice = result.activity.products[0].floorPrice.toFixed(2);
            me.salePrice = result.activity.products[0].salePrice.toFixed(2);
            me.quantity = result.subOrders[0].quantity;
            me.orderTime = formatDate(result.extra.orderTime, 'Y-m-d H:i');
            me.shipmentTime = formatDate(result.extra.shipmentTime, 'Y-m-d H:i');
            me.finishedTim = formatDate(result.finishedTim, 'Y-m-d H:i');
            me.quantity = result.subOrders[0].quantity;
            me.logistics = result.extra.name;
            me.waybillNumber = result.extra.no;
            me.contact = result.activity.activityProducts[0].phone;
            me.$apply();
          }
        }
      });
    }
  }
</script>
